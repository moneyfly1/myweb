# 易支付配置指南

## 配置信息说明

根据易支付后台提供的信息，您需要配置以下内容：

### 1. 基础信息

- **网关地址**: `https://9801w.com`
- **商户编号 (pid)**: `2088277030088864`
- **MD5密钥**: `BJDHN6EQDP3ATTFHU2QSMEX1KLFHOKGI`

### 2. 签名方式

易支付支持三种签名方式：
- **MD5签名**：使用MD5密钥进行签名（最简单）
- **RSA签名**：使用RSA密钥对进行签名（更安全）
- **MD5+RSA签名**：同时使用MD5和RSA（推荐，最安全）

### 3. 平台公钥和商户公钥说明

#### 平台公钥（Platform Public Key）
- **来源**：由易支付平台提供，在易支付后台->个人资料->API信息->RSA密钥->平台公钥中查看
- **用途**：用于验证易支付发送给您的回调通知的签名，确保回调来自易支付平台
- **填写位置**：在系统后台支付配置中，选择"易支付（统一配置）"，填写"平台公钥（RSA签名）"字段

#### 商户公钥（Merchant Public Key）
- **来源**：由您自己生成（使用OpenSSL或在线工具）
- **用途**：用于签名您发送给易支付的请求
- **填写位置**：
  1. 在易支付后台->个人资料->API信息->RSA密钥->商户公钥中填写
  2. 对应的商户私钥填写在系统后台支付配置的"商户私钥（RSA签名）"字段

### 4. 配置步骤

#### 方式一：使用MD5签名（最简单）

1. 登录系统后台，进入"支付配置"
2. 选择"易支付（统一配置）"或创建新的支付配置
3. 填写以下信息：
   - **商户ID**: `2088277030088864`
   - **商户密钥**: `BJDHN6EQDP3ATTFHU2QSMEX1KLFHOKGI`
   - **API地址**: `https://9801w.com/api/pay/create`
   - **签名方式**: 选择"MD5签名"
   - **支持的支付方式**: 勾选您需要的支付方式（支付宝、微信、QQ钱包等）

#### 方式二：使用MD5+RSA签名（推荐）

1. 登录系统后台，进入"支付配置"
2. 选择"易支付（统一配置）"或创建新的支付配置
3. 填写以下信息：
   - **商户ID**: `2088277030088864`
   - **商户密钥**: `BJDHN6EQDP3ATTFHU2QSMEX1KLFHOKGI`（MD5密钥）
   - **API地址**: `https://9801w.com/api/pay/create`
   - **签名方式**: 选择"MD5+RSA签名（推荐）"
   - **平台公钥**: 从易支付后台复制平台公钥，粘贴到这里
   - **商户私钥**: 您自己生成的RSA私钥（对应的公钥需要填写到易支付后台）
   - **支持的支付方式**: 勾选您需要的支付方式

### 5. 生成RSA密钥对（如果使用RSA签名）

#### 使用OpenSSL生成（推荐）

```bash
# 生成私钥
openssl genrsa -out merchant_private_key.pem 2048

# 生成公钥
openssl rsa -in merchant_private_key.pem -pubout -out merchant_public_key.pem
```

#### 使用在线工具生成

访问在线RSA密钥生成工具（如：https://www.myssl.cn/tools/merge-pem-cert.html），生成密钥对。

#### 填写密钥

1. 将生成的**公钥内容**复制到易支付后台->个人资料->API信息->RSA密钥->商户公钥
2. 将生成的**私钥内容**复制到系统后台支付配置的"商户私钥（RSA签名）"字段

### 6. 回调地址配置

在支付配置中设置：
- **异步回调地址**: `https://您的域名/api/v1/payment/notify/yipay`
- **同步回调地址**: `https://您的域名/api/v1/payment/success`

### 7. 验证配置

配置完成后，建议进行以下测试：
1. 创建一个小额测试订单
2. 选择易支付进行支付
3. 完成支付后检查订单状态是否自动更新
4. 检查系统日志，确认回调签名验证通过

### 8. 常见问题

#### Q: 平台公钥如何填写？
A: 平台公钥是易支付提供的，您只需要从易支付后台复制并粘贴到系统配置中即可。不需要您自己生成。

#### Q: 商户公钥如何填写？
A: 商户公钥需要您自己生成RSA密钥对，然后将公钥填写到易支付后台，私钥填写到系统配置中。

#### Q: 如果我只使用MD5签名，还需要填写RSA相关字段吗？
A: 不需要。如果选择MD5签名，只需要填写商户ID和MD5密钥即可。

#### Q: 签名验证失败怎么办？
A: 检查以下几点：
1. 确认签名方式选择正确
2. 确认密钥填写正确（注意不要有多余的空格或换行）
3. 确认回调地址配置正确
4. 查看系统日志，检查具体的错误信息

### 9. 安全建议

1. **妥善保管私钥**：商户私钥和MD5密钥都是敏感信息，请妥善保管，不要泄露
2. **使用HTTPS**：确保回调地址使用HTTPS协议
3. **定期更换密钥**：建议定期更换密钥，提高安全性
4. **使用MD5+RSA签名**：如果易支付支持，建议使用MD5+RSA签名方式，安全性更高
